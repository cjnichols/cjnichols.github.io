<!DOCTYPE html>
<html lang="en">

  <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
      <meta name="description" content="">
      <meta name="author" content="">

      <title>WeightsYO!</title>

      <script type="text/javascript">
        var timerStart = Date.now();
      </script>

      <!-- Bootstrap core CSS -->
      <link href="css/bootstrap-slate.min.css" rel="stylesheet">

      <!-- Custom Google Web Font -->
      <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet">
      <link href='http://fonts.googleapis.com/css?family=Lato:100,300,400,700,900,100italic,300italic,400italic,700italic,900italic' rel='stylesheet' type='text/css'>

      <style>
      * {
        margin: 0;
      }
      html, body {
          height: 100%;
      }
      .disabled {
        color: #666;
        font-style: italic;
      }
      .pre-header{
        background: url("http://s3cloud.intrenix.com/oldlinecrossfit/images/production/preheader-background.png") repeat scroll 0 0 rgba(0, 0, 0, 0);
        height: 16px;
        margin: 0;
        position: relative;
        width: 100%;
      }
      .panel-body h3 {
        margin-top: 5px;
      }
      </style>
      
  </head>
  <body>
    <div class="pre-header"><a style="background:url(http://s3cloud.intrenix.com/oldlinecrossfit/images/production/old-line-crossfit-logo.png) no-repeat;background-position: bottom left;background-size: cover; width:189px; height:91px;display:inline-block; padding:0px;margin:-8px 0;" href="/"></a></div>
    <div class="container" style="margin-top: 50px;">
      <div class="row">
        <div class="panel panel-default">
          <div class="panel-body">
            <h3 class="text-center">Enter Weights and Percentages</h3>
            <forzm class="form-inline" role="form">
              <div class="form-group">
                <label for="inputMax" class="sr-only">One Rep Max</label>
                <input type="number" class="form-control" id="max" placeholder="One Rep Max" />
              </div>
              <div class="form-group">
                <label for="inputPercentage">Starting %</label>
                  <select class="form-control" id="percentage" placeholder="Starting %"></select>
              </div>
              <div class="form-group">
                <label for="inputPercentage">Ending %</label>
                  <select class="form-control" id="ending" placeholder="Ending %"></select>
              </div>
              <div class="form-group">
                <label for="inputStep">Step %</label>
                <select class="form-control" id="step" placeholder="Step %"></select>
              </div>
            </forzm>
          </div>
        </div>
      </div>
      <div id="loads"></div>
    </div>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.0/jquery.min.js"></script>
    <script>
      for(var i=0;i<10;i++){
        var per = 50 + (i*5);
        $('#percentage').append(new Option(per+'%', per, true, i === 3));
      }
      for(var i=1;i<=10;i++){
          var per = 50 + (i*5);
          $('#ending').append(new Option(per+'%', per, true, i === 7));
        }
      
      $('#step').append(new Option('5%','5',true,false));
      $('#step').append(new Option('10%','10',true,true));

      $("#max").change(function() {
        updatePercentages();  
      });
      $("#percentage").change(function() {
        $('#ending')
          .find('option')
          .remove()
          .end();
        var selected = $(this).prop("selectedIndex");
        for(var i=selected+1;i<=10;i++){
          var per = 50 + (i*5);
          $('#ending').append(new Option(per+'%', per, true, i === 10));
        }
        updatePercentages();  
      });
      $("#ending").change(function() {
        updatePercentages();  
      });
      $("#step").change(function() {
        updatePercentages();  
      });

      var wheels = [45,45,45,45,35,25,15,10,10,5,5,2.5,2.5];
      var loads = combine(combinations(wheels,1));

      updatePercentages();  
      function updatePercentages(filter){
        var max = $('#max').val(),
            percentage = $('#percentage').val(),
            end = $('#ending').val(),
            step = $('#step').val();

        var percentages = [];
        for(var i=parseInt(percentage);i<=end;i+=parseInt(step)){
          percentages.push((Math.round((max * (i/100))/5)*5));
        }
        updateLoads(filter,parseInt(percentage),percentages,parseInt(step));
      }
   
      function updateLoads(filter,percentage,percentages,step){
        var html = '';
        for(var i=0;i<percentages.length;i++){
          var total = percentages[i];
          html += '<div class="row"><div class="panel panel-default"><div class="panel-heading"><h2 class="panel-title">'+(percentage + (step*i))+'%<span class="pull-right badge">'+total+'#</span></div><div class="panel-body">';
          if(filter){
            var parts = filter.split(/,/);

            var matched = false;
            while(!matched && parts.length>0){
              var found = writePanel(loads,total,parts.join());
              if(found){
                html += found;
                matched = true;;
              }
              parts.pop();
            }
            if(!matched) html += writePanel(loads,total);
          }else{
            html += writePanel(loads,total);
          }
          html += '</div></div></div>';
        }
        $("#loads").empty().append(html);
        $("span.weight").click(function(){
          updatePercentages($(this).text()); 
        });
      }

      function writePanel(loads, total, filter){
        var re = new RegExp('^'+filter,'g');
        var html = '';

        var matched = false;
        for(var j=0;j<loads[total].length;j++){
          if(!filter || loads[total][j].match(re)){
            html += '<span class="weight">' + loads[total][j]+'</span><br/>';
            matched = true;
          }else{
            html += '<span class="weight disabled">' + loads[total][j]+'</span><br/>';
          }
        }
        if(matched) return html;
      }

      function dedup(a){
        return a.filter(function(elem,pos){
          return a.indexOf(elem) === pos;
        });
      }

      function combine(a){
        var loads = {};
        for(var i=0;i<a.length;i++){
          var total = 45+(sum(a[i])*2);
          if(total <= 500){
            if(!loads[total]) loads[total] = [];
            loads[total].push(a[i].join());
          }
        }
        for(var load in loads){
          loads[load] = dedup(loads[load]).sort().reverse();
        }
        return loads;
      }

      function sum(a){
        var total = 0;
        for(var i=0;i<a.length;i++){
          total += a[i];
        }
        return total;
      }

      function combinations(a, min) {
        var fn = function(n, src, got, all) {
            if (n == 0) {
                if (got.length > 0) {
                    all[all.length] = got;
                }
                return;
            }
            for (var j = 0; j < src.length; j++) {
                fn(n - 1, src.slice(j + 1), got.concat([src[j]]), all);
            }
            return;
        }
        var all = [];
        for (var i = min; i < a.length; i++) {
            fn(i, a, [], all);
        }
        all.push(a);
        return all;
      }
    </script>
    <script type="text/javascript">
         $(document).ready(function() {
             $('#domtime').append("DOM Ready In ", Date.now()-timerStart, "</br>");
         });
         $(window).load(function() {
             $('#pagetime').append("Page Loaded In ", Date.now()-timerStart);
         });
    </script>
  </body>
</html>