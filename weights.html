<!DOCTYPE html>
<html lang="en">

  <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="description" content="">
      <meta name="author" content="">

      <title>WeightsYO!</title>

      <script type="text/javascript">
        var timerStart = Date.now();
      </script>

      <!-- Bootstrap core CSS -->
      <link href="css/bootstrap.css" rel="stylesheet">

      <!-- Custom Google Web Font -->
      <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet">
      <link href='http://fonts.googleapis.com/css?family=Lato:100,300,400,700,900,100italic,300italic,400italic,700italic,900italic' rel='stylesheet' type='text/css'>

      <style>
      * {
        margin: 0;
      }
      html, body {
          height: 100%;
      }
      .wrapper {
          min-height: 100%;
          height: auto !important;
          height: 100%;
          margin: 0 auto -25px; /* the bottom margin is the negative value of the footer's height */
      }
      .footer, .push {
          height: 25; /* .push must be the same height as .footer */
      }
      </style>
      
  </head>
  <body>
    <div class="wrapper">
      <div class="container">
        <div class="row">
          <div class="panel panel-default">
            <div class="panel-body">
              <h3>Enter Weights and Percentages</h3>
              <forzm class="form-inline" role="form">
                <div class="form-group">
                  <label for="inputMax" class="sr-only">One Rep Max</label>
                  <input type="number" class="form-control" id="max" placeholder="One Rep Max" />
                </div>
                <div class="form-group">
                  <label for="inputPercentage">Starting %</label>
                    <select class="form-control" id="percentage" placeholder="Starting %"></select>
                </div>
                <div class="form-group">
                  <label for="inputStep">Step %</label>
                  <select class="form-control" id="step" placeholder="Step %"></select>
                </div>
              </forzm>
            </div>
          </div>
        </div>
        <div id="loads"></div>
      </div>
      <div class="push"></div>
    </div>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
    <script>
      for(var i=0;i<10;i++){
        var per = 50 + (i*5);
        $('#percentage').append(new Option(per+'%', per, true, i === 0));
      }
      $('#step').append(new Option('5%','5',true,true));
      $('#step').append(new Option('10%','10',true,false));

      $("#max").change(function() {
        updatePercentages($('#max').val(),$('#percentage').val(),$('#step').val());  
      });
      $("#percentage").change(function() {
        updatePercentages($('#max').val(),$('#percentage').val(),$('#step').val());  
      });
      $("#step").change(function() {
        updatePercentages($('#max').val(),$('#percentage').val(),$('#step').val());  
      });

      var wheels = [45,45,45,45,35,25,15,10,5,5,2.5,2.5];
      var loads = combine(combinations(wheels,1));

      updatePercentages($('#max').val(),$('#percentage').val(),$('#step').val());  
      function updatePercentages(max,percentage,step){
        var percentages = [];
        for(var i=parseInt(percentage);i<=100;i+=parseInt(step)){
          percentages.push((Math.round((max * (i/100))/5)*5));
        }
        updateLoads(max,parseInt(percentage),percentages,parseInt(step));
      }
   
      function updateLoads(max,percentage,percentages,step){
        var html = '';
        for(var i=0;i<percentages.length;i++){
          var total = percentages[i];
          html += '<div class="row"><div class="panel panel-default"><div class="panel-heading"><h2 class="panel-title">'+(percentage + (step*i))+'%<span class="pull-right badge">'+total+'#</span></div><div class="panel-body">';
          for(var j=0;j<loads[total].length;j++){
            html += '<span class="weight">' + loads[total][j]+'</span><br/>';
          }
          html += '</div></div></div>';
        }
        $("#loads").empty().append(html);
        $("span.weight").click(function(){
          alert($(this).text());
        });
      }

      function dedup(a){
        return a.filter(function(elem,pos){
          return a.indexOf(elem) === pos;
        });
      }

      function combine(a){
        var loads = {};
        for(var i=0;i<a.length;i++){
          var total = 45+(sum(a[i])*2);
          if(total <= 500){
            if(!loads[total]) loads[total] = [];
            loads[total].push(a[i].join());
          }
        }
        for(var load in loads){
          loads[load] = dedup(loads[load]).sort().reverse();
        }
        return loads;
      }

      function sum(a){
        var total = 0;
        for(var i=0;i<a.length;i++){
          total += a[i];
        }
        return total;
      }

      function combinations(a, min) {
        var fn = function(n, src, got, all) {
            if (n == 0) {
                if (got.length > 0) {
                    all[all.length] = got;
                }
                return;
            }
            for (var j = 0; j < src.length; j++) {
                fn(n - 1, src.slice(j + 1), got.concat([src[j]]), all);
            }
            return;
        }
        var all = [];
        for (var i = min; i < a.length; i++) {
            fn(i, a, [], all);
        }
        all.push(a);
        return all;
      }
    </script>
    <script type="text/javascript">
         $(document).ready(function() {
             $('#domtime').append("DOM Ready In ", Date.now()-timerStart, "</br>");
         });
         $(window).load(function() {
             $('#pagetime').append("Page Loaded In ", Date.now()-timerStart);
         });
    </script>
  </body>
</html>